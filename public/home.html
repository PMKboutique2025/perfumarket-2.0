<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

  const supabase = createClient(
      'https://lourpqpgiqfyixrvyfuo.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxvdXJwcXBnaXFmeWl4cnZ5ZnVvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5MzgwMzIsImV4cCI6MjA2NTUxNDAzMn0.rHjuYs2WX0eBBjpwM5XM0CZ2-JICe3BCKYTn1flnqBY'
    );

  const lista = document.getElementById("lista-productos");

    // ✅ Leer parámetro desde la URL
  const urlParams = new URLSearchParams(window.location.search);
  const filtroCategoria = urlParams.get('categoria'); // ej. ?categoria=mujer

  // ✅ Aplicar tema visual según categoría
  if (filtroCategoria) {
    document.body.classList.add(`tema-${filtroCategoria.toLowerCase()}`);
  }



  async function cargarProductos() {
    let query = supabase.from('productos').select('*').order('creado_en', { ascending: false });

    if (filtroCategoria) {
      query = query.ilike('categoria', `%${filtroCategoria}%`);
    }

    const { data: productos, error } = await query;

    if (error || !productos) {
      lista.innerHTML = `<p>Error al cargar productos.</p>`;
      return;
    }

    if (productos.length === 0) {
      lista.innerHTML = `<p>No hay productos disponibles en esta categoría.</p>`;
      return;
    }

    lista.innerHTML = "";
    productos.forEach(p => {
      const card = document.createElement("div");
      card.classList.add("card-producto");
      card.innerHTML = `
        <img src="${p.imagen_url}" alt="${p.nombre}" />
        <h3>${p.nombre}</h3>
        <p class="precio">$${p.precio}</p>
        <p>${p.descripcion?.substring(0, 80)}...</p>
        <button class="btn-carrito" data-id="${p.id}">Agregar al carrito</button>
      `;
      lista.appendChild(card);
    });
  }

  cargarProductos();
</script>
